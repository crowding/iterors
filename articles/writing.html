<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="iterors">
<title>Writing Custom Iterators • iterors</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Writing Custom Iterators">
<meta property="og:description" content="iterors">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">iterors</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/iterors.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/README.html">The iterors package: Fast, compact iteration and tools</a>
    <a class="dropdown-item" href="../articles/benchmarks.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../articles/categories.html">Index of `iteror` functions by task</a>
    <a class="dropdown-item" href="../articles/cross-reference.html">Cross reference from iterarors/itertools to iterors</a>
    <a class="dropdown-item" href="../articles/writing.html">Writing Custom Iterators</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/crowding/iterors/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Writing Custom Iterators</h1>
                        <h4 data-toc-skip class="author">Steve Weston
(originally for package <code>iterators</code>)</h4>
                        <h4 data-toc-skip class="author">Peter Meilstrup
(adapted for package <code>iterors</code>)</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/crowding/iterors/blob/HEAD/vignettes/writing.Rmd" class="external-link"><code>vignettes/writing.Rmd</code></a></small>
      <div class="d-none name"><code>writing.Rmd</code></div>
    </div>

    
    
<p>An <em>iterator</em> is a special type of object that supplies data
on demand, one element <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;An ``element’’ in this case can be basically any object.
I don’t mean to suggest that the data is necessarily returned as scalar
values, for example.&lt;/p&gt;"><sup>1</sup></a> at a time. This is a nice abstraction that
can help simplify many programs. Iterators are particularly useful in
parallel computing, since they facilitate splitting a problem into
smaller pieces that can then be executed in parallel.</p>
<p>Iterators can also be used to reduce the total memory that is needed
at any one time. For example, if you want to process the lines of text
in a file, it is common to write a loop that reads the file one line at
a time, rather than reading the entire file in order to avoid running
out of memory on huge files. That’s the basic idea of iterators.
Iterators provide a standard method for getting the next element, which
allows us to write functions that take an iterator as an argument to
provide a source of data. The function doesn’t need to know what kind of
iterator it is. It just needs to know how to get another piece of data.
The data could be coming from a file, a database, a vector, or it could
be dynamically generated.</p>
<p>There are a number of iterators that come in the <code>iterors</code>
package. The <code>iteror.array</code> method allows you to iterate over
arrays, in much the same way as the standard <code>apply</code>
function. <code>apply</code> has fixed rules on how the results are
returned, which may require you to reshape the results, which can be
inefficient, as well as inconvenient. But since <code>i_apply</code>
doesn’t process any data or combine the results, it is more flexible.
You can use <code>i_apply</code> with the <code>foreach</code> package
to perform a parallel <code>apply</code> operation, and combine the
results any way you want via the <code>.combine</code> argument to
<code>foreach</code>.</p>
<p>Another iterator that comes in the <code>iterors</code> package is
the <code>isplit</code> function, which works much like the standard
<code>split</code> function. <code>split</code> returns a list
containing all of the data divided into groups. <code>isplit</code> only
generates one group at a time, as they are needed, which can reduce the
amount memory that is needed.</p>
<p>But of course, there will be times when you need an iterator that
isn’t provided by the <code>iterors</code> package. That is when you
need to write your own custom iterator. Fortunately, that is fairly easy
to do.</p>
<div class="section level2">
<h2 id="what-methods-are-needed-for-an-iteror">What methods are needed for an iteror?<a class="anchor" aria-label="anchor" href="#what-methods-are-needed-for-an-iteror"></a>
</h2>
<p>Basically, an <code>iteror</code> is an S3 object whose base class is
<code>"iteror"</code>, which has defined methods called
<code>nextOr</code> and <code>iteror</code>.</p>
<p>The function <code>iteror</code> is a generic method. The purpose of
the <code>iteror</code> method is to construct an iterator for the
specified object. For example, this makes an iteror <code>it</code> out
of a list:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iteror.html">iteror</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>When <code>iteror</code> is called on a list (or any object without a
class) it finds the method <code>iteror.default</code>, which constructs
an iterator which returns one element at a time from the given
vector.</p>
<p>If <code>x</code> is already of class <code>"iteror"</code> then
<code>iteror(x)</code> simply returns <code>x</code>, which seems odd at
first. But the <code>iteror</code> method can be defined for other
objects that don’t define a <code>nextOr</code> method. We call those
objects <em>iterables</em>, meaning that you can iterate over them. The
<code>iterators</code> package defines <code>iteror</code> methods for
vectors, lists, matrices, and data frames, making those objects
iterables. By defining an <code>iteror</code> method for data types, you
can pass those types directly to any function that expects an
iterable.</p>
<p>If you want to create an iterator for some existing class, you can do
that by writing an <code>iteror</code> method that constructs an
appropriate iterator. The alternative is to write your own function that
takes arbitrary arguments, and returns an iterator. You can choose
whichever method is most natural.</p>
<p>The most important method required for iterators is
<code>nextOr(obj, or)</code>. Given an iteror <code>obj</code>, this
simply returns the next value, or forces and returns its second argument
<code>or.</code> Returning the value of <code>or=</code> indicates that
there are no more values available in the iterator. There is (by design)
no default value for <code>or</code>; you need to specify one.</p>
<p>Above we created an iterator from a list; we can now call
<code>nextOr</code> on that iterator to get the values from the
list:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">it</span>, <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">it</span>, <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3 4</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">it</span>, <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>This shows how <code>nextOr</code> behaves at the stop of iteration,
returning whatever value was given to argument <code>or</code>. Here we
specified NULL, but we will later see other ways to use the second
argument.</p>
</div>
<div class="section level2">
<h2 id="handling-the-end-of-iteration">Handling the end of iteration<a class="anchor" aria-label="anchor" href="#handling-the-end-of-iteration"></a>
</h2>
<p>In many situations, you will be dealing with effectively finite data,
but data for which you don’t necessarily know the length. So if you
extract values one at a time from an iterator, you need to handle the
case where there isn’t a next value. This is where the
<code>iterors</code> package improves on <code>iterators</code> by
giving you a few options for how to respond to the end of iteration.</p>
<div class="section level3">
<h3 id="breaking-out-of-a-loop-at-end-of-iteration">Breaking out of a loop at end of iteration<a class="anchor" aria-label="anchor" href="#breaking-out-of-a-loop-at-end-of-iteration"></a>
</h3>
<p>If you are consuming an iterator in a loop, the easiest (and often
fastest) way to respond to the end of iteration so to break out of the
loop. You just put a break directly in the second argument of
<code>nextOr</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/icount.html">icount</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="kw">repeat</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">break</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## [1] 5</span></span>
<span><span class="co">## [1] 6</span></span>
<span><span class="co">## [1] 7</span></span>
<span><span class="co">## [1] 8</span></span>
<span><span class="co">## [1] 9</span></span>
<span><span class="co">## [1] 10</span></span></code></pre>
<p>Because the <code>or</code> argument is lazily evaluated, the
<code><a href="https://rdrr.io/r/base/Control.html" class="external-link">break</a></code> does not execute until <code>nextOr</code> evaluates
its second argument. You can put any code into the <code>or</code>
argument, which will come in useful below.</p>
</div>
<div class="section level3">
<h3 id="detecting-end-of-iteration-with-a-sentinel-value">Detecting end of iteration with a sentinel value<a class="anchor" aria-label="anchor" href="#detecting-end-of-iteration-with-a-sentinel-value"></a>
</h3>
<p>Sometimes a break or return isn’t the right action to take. As we saw
above, <code>nextOr</code> will return its second argument (whatever
that is) to signal end of iteration, when the iterator contains no more
data. So you can check whether the returned value is the same as the one
you provided, and interpret that as the end of iteration.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/icount.html">icount</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">x</span>, <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## [1] 5</span></span>
<span><span class="co">## [1] 6</span></span>
<span><span class="co">## [1] 7</span></span>
<span><span class="co">## [1] 8</span></span>
<span><span class="co">## [1] 9</span></span>
<span><span class="co">## [1] 10</span></span></code></pre>
<p>Here, if <code>nextOr</code> returns <code>NULL</code>, the
<code>while</code> loop will exit. A special value used like
<code>NULL</code> is used above, is often called a <em>sentinel
value</em>.</p>
<div class="section level4">
<h4 id="unsafe-sentinel-values">Unsafe sentinel values<a class="anchor" aria-label="anchor" href="#unsafe-sentinel-values"></a>
</h4>
<p>It’s popular to use <code>NULL</code> as a sentinel, but it’s worth
considering what would happen if there were an iterator that
legitimately returns <code>NULL</code> as a value. For instance, this
list contains some tricky values:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bad_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">.StopIteration</span><span class="op">)</span>,</span>
<span>  <span class="cn">NA</span>,</span>
<span>  <span class="cn">NULL</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">simpleError</a></span><span class="op">(</span><span class="st">"StopIteration"</span><span class="op">)</span>,</span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"StopIteration"</span>, call.<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="st">""</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Suppose you iterate over this list using NULL as your
end-of-iteration sentinel, like this:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iteror.html">iteror</a></span><span class="op">(</span><span class="va">bad_values</span><span class="op">)</span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">it</span>, <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## .StopIteration</span></span>
<span><span class="co">## [1] NA</span></span></code></pre>
<p>The enumeration stops early because it mistakes <code>NULL</code>, a
legitimate value in the list that we are iterating over, for
<code>NULL</code> the sentinel value. This is a general problem with the
sentinel value scheme in dynamically-typed languages; any value you
could use to signal a stop, could also be a legitimate value for an
iterator to emit.</p>
</div>
<div class="section level4">
<h4 id="safe-sentinel-values">Safe sentinel values<a class="anchor" aria-label="anchor" href="#safe-sentinel-values"></a>
</h4>
<p>A way to escape this problem is to construct a one-shot,
<em>unique</em> sentinel value to use locally, just with this iteror,
and then throw away, not keeping it in your code. One easy way to do
this by using <code><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env()</a></code>. Consuming an iterator using a
local sentinel value looks like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">end_sentinel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iteror.html">iteror</a></span><span class="op">(</span><span class="va">bad_values</span><span class="op">)</span></span>
<span><span class="kw">repeat</span> <span class="op">{</span></span>
<span>  <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">it</span>, <span class="va">end_sentinel</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">val</span>, <span class="va">end_sentinel</span><span class="op">)</span><span class="op">)</span> <span class="kw">break</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## .StopIteration</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## list()</span></span>
<span><span class="co">## &lt;simpleError: StopIteration&gt;</span></span>
<span><span class="co">## [1] "Error : StopIteration\n"</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "try-error"</span></span>
<span><span class="co">## attr(,"condition")</span></span>
<span><span class="co">## &lt;simpleError: StopIteration&gt;</span></span>
<span><span class="co">## [1] ""</span></span>
<span><span class="co">## numeric(0)</span></span></code></pre>
<p>Because environments compare by reference, a newly constructed
environment is guaranteed not to be <code><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical()</a></code> to any
other object in the R session, and the check for identity is very fast
(just a pointer comparison.) By using a locally generated, unique
sentinel value you avoid mistaking a legitimate value in your data for
the end of iteration.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="a-simple-iterator">A simple iterator<a class="anchor" aria-label="anchor" href="#a-simple-iterator"></a>
</h2>
<p>It’s time to show the implementation of a very simple iterator.
Although I’ve made it sound like you have to write your own
<code>nextOr</code> methods, you can use a standard one. In fact, that’s
what all of the following examples do. The method
<code>iteror.function</code> takes a function you specify and wraps it
in an object with class <code>iteror</code>, which has a
<code>nextOr</code> method defined.</p>
<p>Now here’s a function that creates a very simple iterator, one that
returns the same value <code>x</code> indefinitely.:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iforever</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">nextOr_</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">or</span><span class="op">)</span> <span class="va">x</span></span>
<span>  <span class="fu"><a href="../reference/iteror.html">iteror</a></span><span class="op">(</span><span class="va">nextOr_</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note that I called the internal function <code>nextOr_</code> with an
underscore, rather than <code>nextOr</code>. I do that by convention to
avoid masking the standard <code>nextOr</code> generic function. That
would cause problems when you want your iterator to call the
<code>nextOr</code> method of another iterator, which can be quite
useful, as we’ll see in a later example.</p>
<p>We create an instance of this iterator by calling the
<code>iforever</code> function, and then use it by calling the
<code>nextOr</code> method on the resulting object:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu">iforever</span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">it</span>, <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 42</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">it</span>, <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 42</span></span></code></pre>
<p>You can also get values from an iterator using
<code>as.numeric</code>. But since this is an infinite iterator, you
need to also give an argument <code>n</code> argument to avoid getting
stuck in an infinite loop until you run out of memory:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">it</span>, n<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 42 42 42 42 42 42</span></span></code></pre>
<p>Notice that it doesn’t make sense to implement this iterator by
defining a new <code>iteror</code> method, since there is no natural
iterable to dispatch on; the argument 42 is just a vector of length 1
and <code>iterator.default</code> already handles that case. So instead,
we implement this iterator by defining a normal function that returns
the iterator.</p>
<p>This iterator is quite simple to implement, and possibly even useful.
<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Be careful how you use this iterator! If you pass it to
&lt;code&gt;foreach&lt;/code&gt;, it will result in an infinite loop unless you pair
it with a non-infinite iterator. Also, &lt;em&gt;never&lt;/em&gt; pass this to the
&lt;code&gt;as.list&lt;/code&gt; function without the &lt;code&gt;n&lt;/code&gt; argument.&lt;/p&gt;"><sup>2</sup></a> The
iterator returned by <code>iforever</code> is actually just the same
function you provided, with the class <code>iteror</code> added. This
means you get <code>nextOr</code> method already defined, whlch just
delegates to your given function. Additionally since the returned object
has class <code>iteror</code>, it inherits an <code>iteror</code> method
that will return itself.</p>
<p>Of course, the reason this iterator is so simple is because it
doesn’t contain any state. Most iterators need to contain some state, or
it will be difficult to make it return different values and eventually
stop. Managing the state is usually the real trick to writing
iterators.</p>
</div>
<div class="section level2">
<h2 id="a-stateful-iterator-that-stops">A stateful iterator that stops<a class="anchor" aria-label="anchor" href="#a-stateful-iterator-that-stops"></a>
</h2>
<p>Let’s modify the previous iterator <code>iforever</code> to stop
after it returns a certain number of values. I’ll call the new function
<code>irep</code>, and give it another argument called
<code>times</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">irep</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">times</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">nextOr_</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">or</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">times</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">times</span> <span class="op">&lt;&lt;-</span> <span class="va">times</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>      <span class="va">x</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">or</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/iteror.html">iteror</a></span><span class="op">(</span><span class="va">nextOr_</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now let’s try it out:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu">irep</span><span class="op">(</span><span class="fl">7</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 7 7 7 7 7 7</span></span></code></pre>
<p>The differences between <code>iforever</code> and <code>irep</code>
are in the inner function <code>nextOr_</code>. This inner function not
only accesses the values of the variables <code>x</code> and
<code>times</code>, but it also modifies the value of
<code>times</code>. This is accomplished by means of the
“<code>&lt;&lt;-=</code>”<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;It’s commonly believed that &lt;code&gt;&amp;lt;&amp;lt;-&lt;/code&gt; is
only used to set variables in the global environment, but that isn’t
true. I think of it as an &lt;em&gt;inheriting&lt;/em&gt; assignment operator.}&lt;/p&gt;"><sup>3</sup></a> operator, and the rules of lexical
scoping.</p>
<p>After enough calls, the inner function will find
<code>times &lt;= 0</code>, and will return its argument
<code>or</code>. As the author of an iterator this is how you signal end
of iteration. When implementing an iterator you never need to do
anything with <code>or</code> other than return it when appropriate;
otherwise leave it alone, allowing R to be lazy in treating that
argument.</p>
<p>Technically, this kind of function that refers to enclosing variables
is called a <em>closure</em>, and is a fundamental feature of
<code>R</code>. The important thing to remember is that
<code>nextOr_</code> is able to get the value of variables that were
passed as arguments to <code>irep</code>, and it can modify those values
using the <code>&lt;&lt;-</code> operator. These are <em>not</em> global
variables: they are defined in the enclosing environment of the
<code>nextOr_</code> function. You can create as many iterators as you
want using the <code>irep</code> function, and they will all work as
expected without conflicts.</p>
<p>Note that this iterator only uses the arguments to <code>irep</code>
to store its state. If any other state variables are needed, they can be
defined anywhere inside the <code>irep</code> function.</p>
</div>
<div class="section level2">
<h2 id="using-an-iterator-inside-an-iterator">Using an iterator inside an iterator<a class="anchor" aria-label="anchor" href="#using-an-iterator-inside-an-iterator"></a>
</h2>
<p>The previous section described a general way of writing custom
iterators. Almost any iterator can be written using those basic
techniques. At times, it may be simpler to make use of an existing
iterator to implement a new iterator. Let’s say that you need an
iterator that splits a vector into subvectors. That can allow you to
process the vector in parallel, but still use vector operations, which
is essential to getting good sequential performance in R. The following
function returns just such an iterator:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ivector</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span> <span class="va">it</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/idiv.html">idiv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">nextOr_</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">or</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">it</span>, <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">or</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="va">ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">i</span>, length<span class="op">=</span><span class="va">n</span><span class="op">)</span></span>
<span>   <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="va">n</span></span>
<span>   <span class="va">x</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span></span>
<span> <span class="op">}</span></span>
<span></span>
<span> <span class="fu"><a href="../reference/iteror.html">iteror</a></span><span class="op">(</span><span class="va">nextOr_</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><code>ivector</code> uses <code>...</code> to pass options on to
<code>idiv</code>. <code>idiv</code> supports the <code>chunks</code>
argument to split its argument into a specified number of pieces, and
the <code>chunkSize</code> argument to split it into pieces of a
specified maximum size.</p>
<p>Let’s create an <code>ivector</code> iterator to split a vector into
three pieces using the <code>chunks</code> argument:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu">ivector</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span>, chunks<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] 1 2 3 4 5 6 7 8 9</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] 10 11 12 13 14 15 16 17</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [1] 18 19 20 21 22 23 24 25</span></span></code></pre>
<p>Note how our <code>nextOr_</code> function handles the end of
iteration. If the underlying <code>idiv</code> iterator reaches the end,
it will force its <code>or</code> argument, which we have specified as
<code>return(or)</code>, Although it is forced by the underlying
iterator, R correctly evaluates a <code>return</code> call in a lazy
argument according to the scope that call was written in. So when
<code>it</code> of the internal <code>idiv</code> reaches the end, and
forces its <code>or</code> argument, our <code>nextOr_</code> passes
that signal along by returning <em>its</em> <code>or</code>
argument.</p>
<p>The <code>nextOr</code> method uses a lazy evaluated argument
expressly for this purpose, so that you can respond to end of iteration
by using a control flow operator like <code>return</code>,
<code><a href="https://rdrr.io/r/base/Control.html" class="external-link">break</a></code>, <code><a href="https://rdrr.io/r/base/Control.html" class="external-link">next</a></code> or <code>stop</code>.</p>
<p>It should be clear that only minor modification need to be made to
this function to create an iterator over the blocks of rows or columns
of a matrix or data frame. But I’ll leave that as an exercise for the
reader.</p>
</div>
<div class="section level2">
<h2 id="a-recycling-iterator">A recycling iterator<a class="anchor" aria-label="anchor" href="#a-recycling-iterator"></a>
</h2>
<p>You can start to compose simple iterators together to do more complex
things by writing functions that take in one iterator and construct a
new one. In this example, we’ll return an iterator that recycles the
values of the wrapped iterator: <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Actually, many of the standard &lt;code&gt;iteror&lt;/code&gt;
methods support a &lt;code&gt;recycle&lt;/code&gt; argument. But this is a nice
example, and a more general solution, since it works on any iterator.&lt;/p&gt;"><sup>4</sup></a></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i_recycle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">it</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="../reference/iteror.html">iteror</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">nextOr_</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">or</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span><span class="op">)</span> <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="va">values</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/iteror.html">iteror</a></span><span class="op">(</span><span class="va">nextOr_</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This is fairly nice, but note that this is another one of those
infinite iterators that we need to be careful about. Also, make sure
that you don’t pass an infinite iterator to <code>i_recycle</code>. That
would be pointless of course, since there’s no reason to recycle an
iterator that never ends. It would be possible to write this to avoid
that problem by not grabbing all of the values right up front, but you
would still end up saving values that will never be recycled, so I’ve
opted to keep this simple.</p>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/i_recycle.html">i_recycle</a></span><span class="op">(</span><span class="fu"><a href="../reference/icount.html">icount</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">it</span>, n<span class="op">=</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2 3 1 2 3 1 2 3</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="limiting-infinite-iterators">Limiting infinite iterators<a class="anchor" aria-label="anchor" href="#limiting-infinite-iterators"></a>
</h2>
<p>I was tempted to add an argument to the <code>i_recycle</code>
function to limit the number of values that it returns, because
sometimes you want to recycle for awhile, but not forever. I didn’t do
that, because rather than make <code>i_recycle</code> more complicated,
I decided to write another function that takes an iterator and returns a
modified iterator. Functions like this are <em>composable</em>; the
limiting function can be applied to any underlying iterator instead of
just <code>i_recycle</code>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i_limit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">it</span>, <span class="va">times</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">it</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iteror.html">iteror</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">nextOr_</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">or</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">times</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">times</span> <span class="op">&lt;&lt;-</span> <span class="va">times</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>      <span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">it</span>, <span class="va">or</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">or</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/iteror.html">iteror</a></span><span class="op">(</span><span class="va">nextOr_</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>By convention, the <code>iterors</code> package uses the prefix
<code>i_</code> for this kind of composing iterator function, and a bare
<code>i</code> for functions that build an iterator based on basic
data.</p>
<p>Note that this looks an awful lot like the <code>irep</code> function
that we implemented previously. In fact, using <code>i_limit</code>, we
can implement <code>irep</code> using <code>iforever</code> much more
simply, and without duplication of code:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">irep2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">times</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/i_limit.html">i_limit</a></span><span class="op">(</span><span class="fu">iforever</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">times</span><span class="op">)</span></span></code></pre></div>
<p>To demonstrate <code>irep2</code>:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu">irep2</span><span class="op">(</span><span class="st">'foo'</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="kw">repeat</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/nextOr.html">nextOr</a></span><span class="op">(</span><span class="va">it</span>, <span class="kw">break</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "foo"</span></span>
<span><span class="co">## [1] "foo"</span></span>
<span><span class="co">## [1] "foo"</span></span></code></pre>
<p>Here’s one last example. Let’s recycle a vector three times using
<code>i_limit</code>, and convert it back into a vector using
<code>as.numeric</code>:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iterable</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/i_limit.html">i_limit</a></span><span class="op">(</span><span class="fu"><a href="../reference/i_recycle.html">i_recycle</a></span><span class="op">(</span><span class="va">iterable</span><span class="op">)</span>, <span class="va">n</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">iterable</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2 3 1 2 3 1 2 3</span></span></code></pre>
<p>Sort of a complicated version of:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">iterable</span>, <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2 3 1 2 3 1 2 3</span></span></code></pre>
<p>Aren’t iterators fun?</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Writing your own iterators can be quite simple, and yet is very
useful and powerful. It provides a very effective way to extend the
capabilities of other packages that use iterators, such as the
<code>foreach</code> package. By writing iterators that wrap other
iterators, it is possible to put together a powerful and flexible set of
tools that work well together, and that can solve many of the complex
problems that come up in parallel computing.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Peter Meilstrup, Folashade Daniel, Revolution Analytics, Steve Weston, John A. Ramey, Kayla Schaefer, Hadley Wickham.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
